/* Private Internet Access(TM) browser extension (v1.3.1) */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}var e=a("util/storage"),f=d(e),g=a("util/settings"),h=d(g),i=a("util/webrtc"),j=d(i),k=a("util/icon"),l=d(k),m=a("util/eventhandler"),n=d(m),o=a("util/regionlist"),p=d(o),q=a("util/regionsorter"),r=d(q),s=a("util/proxysettings"),t=d(s),u=a("util/user"),v=d(u),w=a("util/bypasslist"),x=d(w),y=a("util/latencytest"),z=d(y),A=a("util/buildinfo"),B=d(A),C=a("util/logger"),D=d(C),E=a("util/counter"),F=d(E),G=a("util/contentsetting"),H=d(G),I=a("util/microphonesettings"),J=d(I),K=a("util/camerasettings"),L=d(K),M=a("util/locationsettings"),N=d(M),O=a("util/flashsettings"),P=d(O),Q=a("util/settingsmanager"),R=d(Q),S=a("util/http"),T=d(S);new function(a){var b=this;return b.window=a,b.buildinfo=new B["default"](b),b.logger=new D["default"](b),b.window.debug=b.logger.debug,b.util={},b.util.http=new T["default"](b),b.util.icon=new l["default"](b),b.util.eventhandler=new n["default"](b),b.util.proxysettings=new t["default"](b),b.util.storage=new f["default"](b),b.util.settings=new h["default"](b),b.util.regionlist=new p["default"](b),b.util.bypasslist=new x["default"](b),b.util.webrtc=new j["default"](b),b.util.counter=new F["default"](b),b.util.user=new v["default"](b),b.util.latencytest=new z["default"](b),b.util.regionsorter=new r["default"](b),b.util.contentsetting=new H["default"](b),b.util.flashsettings=new P["default"](b),b.util.microphonesettings=new J["default"](b),b.util.camerasettings=new L["default"](b),b.util.locationsettings=new N["default"](b),b.util.settingsmanager=new R["default"](b),b.util=Object.freeze(b.util),function(){var a=b.util.user,c=(b.util.settings,b.util.proxysettings),d=b.util.regionlist;a.inStorage()||c.disable(),d.synced||d.sync(),c.read(function(){c.underPIAControl&&a.inStorage()&&a.auth(function(){},function(){return c.disable()})}),debug("background.js: initialized.")}(),a.app=Object.freeze(b),a.onerror=function(a,b,c,d,e){var f=b.split("/").slice(-1);debug("javascript error at "+f+":"+c+": "+a)},chrome.runtime.onInstalled.addListener(function(a){"update"===a.reason&&chrome.tabs.create({url:chrome.extension.getURL("html/updatemessage.html")})}),a.app}(window,document)},{"util/buildinfo":24,"util/bypasslist":6,"util/camerasettings":7,"util/contentsetting":8,"util/counter":9,"util/eventhandler":10,"util/flashsettings":11,"util/http":12,"util/icon":13,"util/latencytest":14,"util/locationsettings":15,"util/logger":16,"util/microphonesettings":17,"util/proxysettings":18,"util/regionlist":25,"util/regionsorter":19,"util/settings":20,"util/settingsmanager":21,"util/storage":22,"util/user":26,"util/webrtc":23}],2:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=["net::ERR_CONNECTION_RESET","net::ERR_PROXY_CONNECTION_FAILED"],c=chrome.extension.getURL("html/connectionfail.html"),d={active:!0,status:"loading",url:["http://*/*","https://*/*"]},e=function(a){a.forEach(function(a){return chrome.tabs.update(a.id,{url:c})})};return function(c){var f=a.util.proxysettings;if(f.controlledByPIA&&c.fatal&&b.indexOf(c.error)>-1)return chrome.tabs.query(d,e),{cancel:!0}}}},{}],3:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){return function(b,c,d){switch(b){case"RequestCredentials":var e=a.util.user,f=e.username(),g=e.password();e.authed&&d({user:f,pass:g})}}}},{}],4:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=function(a){var b=a.isProxy,c=a.challenger.host.match(/^https-.+\.privateinternetaccess\.com$/);return!!b&&!!c};return function(c){var d=a.util.proxysettings,e=a.util.counter,f=a.util.user;return b(c)?(e.inc(c.requestId),e.get(c.requestId)>1?(debug("onAuthRequired/1: authentication failed."),e.del(c.requestId),chrome.tabs.update({url:chrome.extension.getURL("html/authfail.html")}),d.disable(function(){return f.authed=!1}),{cancel:!0}):f.inStorage()?(debug("onAuthRequired/1: allow authentication."),{authCredentials:{username:f.username(),password:f.password()}}):(debug("onAuthRequired/1: asked to authenticate but credentials not in storage."),d.disable(function(){return chrome.tabs.reload(c.tabId)}),{cancel:!0})):void debug("onAuthRequired/1: refuse authentication.")}}},{}],5:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){return function(b){var c=a.util.counter;c.get(b.requestId)>=1&&c.del(b.requestId)}}},{}],6:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c="bypasslist:customlist",e=new Set(["0.0.0.0/8","127.0.0.0/8","169.254.0.0/16","192.168.0.0/16","172.16.0.0/12","::1","localhost","*.local"]),f=function(a){return a.split(",").map(function(a){return a.trim()}).filter(function(a){return a.length>0})},g=a.util.storage,h=a.util.regionlist,i=new Set;return b.append=function(a){return g.setItem(c,a),i=new Set(f(g.getItem(c)))},b.stringForDisplay=function(){return[].concat(d(i)).join(",")},b.toArray=function(){var a=h.toArray().map(function(a){return"http://"+a.host+":8888"});return[].concat(d(new Set([].concat(d(e),d(a),d(i)))))},g.hasItem(c)&&g.getItem(c).length>0&&(i=new Set(f(g.getItem(c)))),b}},{}],7:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=a.util.contentsetting;return b.key="camera",b.logName="camerasettings",b.blocked=!1,b.block=function(a){c.block(b,{},a)},b.clear=function(a){var d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c.clear(b,{},a,d)},b}},{}],8:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=new Set([]),d=function(){c.forEach(function(a){a.blocked&&a.block()})};return b.block=function(a,b,d){var e=Object.assign({scope:"regular",primaryPattern:"<all_urls>",setting:"block"},b);chrome.contentSettings[a.key].set(e,function(){chrome.runtime.lastError?debug((a.logName||a.key)+": block failed."):(debug((a.logName||a.key)+": blocked."),a.blocked=!0),d&&d(a.blocked),c.add(a)})},b.clear=function(a,b,c){var e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],f=Object.assign({scope:"regular"},b);chrome.contentSettings[a.key].clear(f,function(){chrome.runtime.lastError?debug((a.logName||a.key)+": clear failed."):(debug((a.logName||a.key)+": cleared."),a.blocked=!1),e&&d(),c&&c(a.blocked)})},b}},{}],9:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c={};return b.get=function(a){return c[a]||0},b.inc=function(a){return c[a]=(c[a]||0)+1},b.del=function(a){return delete c[a]},b}},{}],10:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=(0,f["default"])(a),d=(0,h["default"])(a),e=(0,j["default"])(a),g=(0,l["default"])(a);return chrome.webRequest.onAuthRequired.addListener(d,{urls:["<all_urls>"]},["blocking"]),chrome.webRequest.onCompleted.addListener(e,{urls:["<all_urls>"]}),chrome.proxy.onProxyError.addListener(c),chrome.runtime.onMessage.addListener(g),b};var e=a("eventhandler/chrome/proxy/onproxyerror"),f=d(e),g=a("eventhandler/chrome/webrequest/onauthrequired"),h=d(g),i=a("eventhandler/chrome/webrequest/oncompleted"),j=d(i),k=a("eventhandler/chrome/runtime/onmessage"),l=d(k)},{"eventhandler/chrome/proxy/onproxyerror":2,"eventhandler/chrome/runtime/onmessage":3,"eventhandler/chrome/webrequest/onauthrequired":4,"eventhandler/chrome/webrequest/oncompleted":5}],11:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c="adobe-flash-player",d=a.util.contentsetting;return b.key="plugins",b.logName="flashsettings",b.blocked=!1,b.block=function(a){d.block(b,{resourceIdentifier:{id:c}},a)},b.clear=function(a){var c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];d.clear(b,{},a,c)},b}},{}],12:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this;return b.ajax=function(a,b){var c=new XMLHttpRequest,d=b.success||function(){},e=b.error||function(){},f=b.complete||function(){},g=b.beforeSend||function(){},h=b.headers||{},i=b.timeout||c.timeout,j=b.method||"GET",k=function(){4===c.readyState&&c.status>0&&(String(c.status).match(/^2\d{2}$/)?d(c):e(c),f(c))};c.open(j,a,!0);for(var l in h)c.setRequestHeader(l,h[l]);c.timeout=i,c.addEventListener("abort",function(){return[e(c,"abort"),f(c)]}),c.addEventListener("timeout",function(){return[e(c,"timeout"),f(c)]}),c.addEventListener("error",function(){return[e(c,"error"),f(c)]}),c.addEventListener("readystatechange",k),g(c),c.send(null)},b.get=function(a,c){return b.ajax(a,Object.assign({},c,{method:"GET"}))},b.head=function(a,c){return b.ajax(a,Object.assign({},c,{method:"HEAD"}))},b}},{}],13:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c="/images/icons/icon48.png",d="/images/icons/icon48red.png";return b.online=function(){return chrome.browserAction.setIcon({path:c})},b.offline=function(){return chrome.browserAction.setIcon({path:d})},b}},{}],14:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=a.util.http;return b.freeResources=function(){return performance.clearResourceTimings()},b.testCount=0,b.start=function(a,d){return new Promise(function(e){for(var f=0,g="http://"+a.host+":8888/ping.txt",h={timeout:3500,complete:function(){if(f+=1,f===d){var c=performance.getEntriesByName(g),h=c.reduce(function(a,b){return a+b.duration},0),i=h/d;e({region:a,latencyAvg:0===i?"error":i}),b.testCount--}}},i=0;i<d;i++)c.get(g,h);b.testCount++})},b}},{}],15:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=a.util.contentsetting;return b.key="location",b.logName="locationsettings",b.blocked=!1,b.block=function(a){c.block(b,{},a)},b.clear=function(a){var d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c.clear(b,{},a,d)},b}},{}],16:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=[],c=new Map([["NewMessage",[]]]),d=200;return this.debug=function(e,f){a.util.settings.getItem("debugmode")&&setTimeout(function(){f&&!f()||(b.length===d&&b.shift(),b.push([(new Date).toISOString(),e]),c.get("NewMessage").forEach(function(a){return a(e)}))},250)},this.getEntries=function(){return Array.from(b).reverse()},this.removeEntries=function(){b=[]},this.addEventListener=function(a,b){c.get(a).push(b)},this.removeEventListener=function(a,b){var d=c.get(a);Array.from(d).forEach(function(a,c){a===b&&delete d[c]})},this}},{}],17:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=a.util.contentsetting;return b.key="microphone",b.logName="microphonesettings",b.blocked=!1,b.block=function(a){c.block(b,{},a)},b.clear=function(a){var d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c.clear(b,{},a,d)},b}},{}],18:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=function(b){return{scheme:b.scheme,host:b.host,port:a.util.settings.getItem("maceprotection")?b.macePort:b.port}},d=function(c){var d=a.util.icon,e=a.util.settingsmanager;b.uncontrollableByAll="not_controllable"===c.levelOfControl,b.controlledByOther="controlled_by_other_extensions"===c.levelOfControl,b.controlledByPIA="controlled_by_this_extension"===c.levelOfControl,b.controllableByPIA="controllable_by_this_extension"===c.levelOfControl,b.underPIAControl=b.controlledByPIA||b.controllableByPIA,b.controlledByPIA?(e.block(),d.online()):(e.clear(),d.offline()),b.loaded=!0,debug("proxysettings.sync/1: completed sync.")};return b.underPIAControl=!1,b.controlledByPIA=!1,b.controllableByPIA=!1,b.controlledByOther=!1,b.uncontrollableByAll=!1,b.loaded=!1,b.read=function(a){chrome.proxy.settings.get({},function(b){d(b),a&&a(b)})},b.enable=function(d,e){var f=a.util.bypasslist,g=(a.util.settingsmanager,c(d)),h={mode:"fixed_servers",rules:{singleProxy:g,bypassList:f.toArray()}};return chrome.proxy.settings.set({value:h,scope:"regular"},function(){e&&e(b),debug("proxysettings.enable/2: proxy enabled.")})},b.disable=function(c){a.util.settingsmanager;return chrome.proxy.settings.clear({scope:"regular"},function(){c&&c(b),debug("proxysettings.disable/1: proxy disabled.")})},chrome.proxy.settings.onChange.addListener(d),b}},{}],19:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=a.util.latencytest,d=function(a){return a.every(function(a){return a.offline})},e=function(a,b){"error"===b||b>3500?(a.offline=!0,a.latency=5e4,debug("regionsorter.setRegionState/2: '"+a.name.toLowerCase()+"' region is offline.")):(a.offline=!1,a.latency=b)},f=function(a,e){if(0===c.testCount)return d(e)?b.sortByName(e).then(function(b){return a(b)}):a(e.sort(function(a,b){return a.latency-b.latency})),c.freeResources(),debug("regionsorter.finished/3: finished latency test."),!0},g=void 0;return b.sortByName=function(a){return new Promise(function(b){b(a.sort(function(a,b){return a.name.localeCompare(b.name)}))})},b.sortByLatency=function(a){return g=g||new Promise(function(b){for(var d=0,h=6,i=1,j=function l(h){var j=h.region,k=h.latencyAvg;e(j,k),d++,f(b,a)?g=void 0:a[d]&&c.start(a[d],i).then(l)},k=0;k<h;k++)c.start(a[k],i).then(j)})},b}},{}],20:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=a.util.storage,d={blockplugins:!0,blockadobeflash:!0,preventwebrtcleak:!0,maceprotection:!0,blockcamera:!0,blockmicrophone:!0,blocklocation:!0,debugmode:!1,rememberme:!1};return b.asJSON=function(){var a={};for(var c in d)a[c]=b.getItem(c);return a},b.hasItem=function(a){return c.hasItem("settings:"+a)},b.getItem=function(a){return"true"===c.getItem("settings:"+a)},b.setItem=function(a,b){b===!0||"true"===b?c.setItem("settings:"+a,"true"):c.setItem("settings:"+a,"false")},Object.keys(d).forEach(function(a){b.hasItem(a)||b.setItem(a,d[a])}),b}},{}],21:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=a.util.settings,d=a.util.camerasettings,e=a.util.microphonesettings,f=a.util.locationsettings,g=a.util.webrtc,h=a.util.flashsettings;return b.block=function(){c.getItem("preventwebrtcleak")&&g.block(),c.getItem("blockcamera")&&d.block(),c.getItem("blockmicrophone")&&e.block(),c.getItem("blocklocation")&&f.block(),c.getItem("blockadobeflash")&&h.block()},b.clear=function(){g.clear(),d.clear(null,!1),e.clear(null,!1),f.clear(null,!1),h.clear(null,!1)},b}},{}],22:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=a.window.localStorage,d={},e={localStorage:c,memoryStorage:d};return b.hasItem=function(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localStorage",d=b.getItem(a,c);return void 0!==d&&null!==d},b.getItem=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localStorage";switch(b){case"localStorage":return e[b].getItem(a);case"memoryStorage":return e[b][a];default:throw"Unknown store: "+b}},b.setItem=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"localStorage";switch(void 0!==b&&null!==b||(b=""),c){case"localStorage":return e[c].setItem(a,b);case"memoryStorage":return e[c][a]=b,b;default:throw"Unknown store: "+c}},b.removeItem=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localStorage";switch(b){case"localStorage":return e[b].removeItem(a);case"memoryStorage":return delete e[b][a];default:throw"Unknown store: "+b}},b}},{}],23:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=function(a){b.blocked="block_non_proxied_udp"===a.value};return b.blocked=!1,b.blockable=void 0!==chrome.privacy.network.webRTCIPHandlingPolicy,b.clear=function(a){chrome.privacy.network.webRTCIPHandlingPolicy.set({value:"default"},function(){chrome.runtime.lastError?debug("webrtc.clear/1: clear failed. "+chrome.runtime.lastError+"."):(b.blocked=!1,debug("webrtc.clear/1: cleared.")),a&&a(b.blocked)})},b.block=function(a){chrome.privacy.network.webRTCIPHandlingPolicy.set({value:"disable_non_proxied_udp"},function(){chrome.runtime.lastError?debug("webrtc.block/1: block failed. "+chrome.runtime.lastError+"."):(b.blocked=!0,debug("webrtc.block/1: blocked.")),a&&a(b.blocked)})},chrome.privacy.network.webRTCIPHandlingPolicy.onChange.addListener(c),chrome.privacy.network.webRTCIPHandlingPolicy.get({},c),b}},{}],24:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){return Object.freeze({buildname:"webstore",version:"1.3.1",dateofbuild:"Wed, 03 May 2017 15:25:17 GMT",isdebugbuild:!1,coupon:"PIACHROME"})}},{}],25:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=this,c=a.util.storage,d=a.util.http,e="us_new_york_city",f=new Map,g=function(a,b){var c=chrome.i18n.getMessage(a);return c.length>0?c:b.name},h=function(a,b){return{scheme:"https",id:a,name:b.name,localizedName:g(a,b),iso:b.iso,host:b.dns,port:b.port,macePort:b.mace,flag:"/images/flags/"+b.iso+"_64.png",active:!1,latency:0,offline:!1}};return b.synced=!1,b.syncing=!1,b.toArray=function(){return Array.from(f.values())},b.isSelectedRegion=function(a){return b.getSelectedRegion().id===a.id},b.getSelectedRegion=function(){var a=b.toArray().find(function(a){return a.active}),d=c.getItem("region");return a?a:d?JSON.parse(d):void 0},b.setSelectedRegion=function(a){var d=f.get(a);d&&(b.toArray().forEach(function(a){return a.active=!1}),d.active=!0,c.setItem("activeproxy",d.id),c.setItem("region",JSON.stringify(d)))},b.sync=function(a,g){var i=function(){b.syncing=!0,debug("regionlist.sync/2: start sync.")},j=function(){b.syncing=!1},k=function(d){var g=JSON.parse(d.response);f.clear();for(var i in g)f.set(i,h(i,g[i]));b.setSelectedRegion(c.getItem("activeproxy")||e),b.synced=!0,a&&a(b),debug("regionlist.sync/2: successful sync.")},l=function(a,c){b.synced=!1,g&&g(b),debug("regionlist.sync/2: error during sync (errorReason = "+c+")")};return d.get("https://www.privateinternetaccess.com/api/client/services/https",Object.assign({beforeSend:i,complete:j,success:k,error:l,timeout:5e3}))},b}},{}],26:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a,b){var c=this,d=a.util.storage,e=a.util.settings,f=a.util.proxysettings,g=a.util.http;return c.authed=!1,c.authing=!1,c.storageBackend=function(){return e.getItem("rememberme")?"localStorage":"memoryStorage"},c.username=function(){var a=d.getItem("form:username",c.storageBackend());return a?a.trim():""},c.password=function(){var a=d.getItem("form:password",c.storageBackend());return a?a:""},c.removeUsernameAndPasswordFromStorage=function(){d.removeItem("form:username",c.storageBackend()),d.removeItem("form:password",c.storageBackend())},c.inStorage=function(){return c.username().length>0&&c.password().length>0},c.auth=function(a,b){var d=c.username(),e=c.password(),f={Authorization:"Basic "+btoa(unescape(encodeURIComponent(d+":"+e)))},h=function(){debug("user.auth/3: begin authentication."),c.authing=!0},i=function(b){c.authed=!0,a&&a(b)},j=function(a,d){c.authed=!1,b&&b(a,d)},k=function(){debug("user.auth/3: finish authentication."),c.authing=!1};return g.head("https://www.privateinternetaccess.com/api/client/auth",Object.assign({success:i,error:j,complete:k,beforeSend:h,headers:f,timeout:5e3}))},c.logout=function(a){f.disable(function(){c.authed=!1,c.removeUsernameAndPasswordFromStorage(),a&&a()})},c}},{}]},{},[1]);