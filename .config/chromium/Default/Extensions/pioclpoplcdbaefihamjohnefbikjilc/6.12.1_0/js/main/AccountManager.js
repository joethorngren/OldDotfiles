/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

!function(){function a(a){this._selectedAccount=null,this._selectedAccountId=null,this._selectedSubpart=GlobalUtils.ACCOUNT_TYPE_PERSONAL,this._accountList=[],this._bootstrapInfo=a.bootstrapInfo,this.onAccountUpdate=a.onAccountUpdate||function(){},this.createUserStore=a.createUserStore,this.reload()}Object.defineProperty(a.prototype,"currentAccount",{get:function(){return this._selectedAccount}}),Object.defineProperty(a.prototype,"currentId",{get:function(){return this._selectedAccount.userInfo.userId}}),Object.defineProperty(a.prototype,"currentSubpart",{get:function(){return this._selectedSubpart}}),Object.defineProperty(a.prototype,"currentUserInfo",{get:function(){return this._selectedAccount.userInfo}}),Object.defineProperty(a.prototype,"accounts",{get:function(){return this._accountList}}),a.prototype.accountHasDefaultNotebook=function(){return this.currentUserInfo.accountType===GlobalUtils.ACCOUNT_TYPE_ONLY_BUSINESS||this._selectedSubpart===GlobalUtils.ACCOUNT_TYPE_PERSONAL},a.prototype.reloadCurrent=function(){return this._selectedAccount.reload()},a.prototype.findAccount=function(a){for(var b=0;b<this._accountList.length;b++)if(this._accountList[b].userInfo.userId&&this._accountList[b].userInfo.userId===a)return this._accountList[b];return null},a.prototype.select=function(a,b){var c=this.findAccount(a);return c?(this._selectedAccount=c,this._selectedAccountId=a,b!==GlobalUtils.ACCOUNT_TYPE_PERSONAL&&b!==GlobalUtils.ACCOUNT_TYPE_BUSINESS?log.error("Incorrect subpart "+b):this._selectedSubpart=b,this._saveData(),!0):(log.error("Unable to select account "+a+" "+b),!1)},a.prototype.removeAccount=function(a){if(!a)return void log.warn("Unable to remove account - no id specified");Persistent.clearForUser("UserInfo",a);var b=this._accountList.findIndex(function(b){return b.userInfo.userId===a});this._accountList.splice(b,1),Persistent.clear("CurrentAccount"),Persistent.clear("CurrentSubpart"),this._selectedSubpart=null,this._selectedAccountId=null},a.prototype.removeAllAccounts=function(){Persistent.clearForAllUsers("UserInfo"),Persistent.clear("CurrentAccount"),Persistent.clear("CurrentSubpart"),this._selectedSubpart=null,this._selectedAccountId=null,this.reload()},a.prototype.reload=function(){var a=this,b=[];this._selectedAccountId=null,this._selectedSubpart=null,0===b.length&&b.push(null);for(var c=0;c<b.length;c++){var d=new Account({host:this._bootstrapInfo.get("serviceHost"),userStore:this.createUserStore(),onUpdated:this.onAccountUpdate,userInfo:b[c],saveUserInfo:function(a){a&&a.userId&&Persistent.setForUser("UserInfo",a.userId,a)}});this._accountList.push(d),d.userInfo.userId===a._selectedAccountId&&(a._selectedAccount=d),b[c]&&d.reload()}a._selectedAccount||(a._selectedAccount=a._accountList[0],a._selectedAccount.reload().then(function(b){a._selectedAccountId=b.userId,a._saveData()}))},a.prototype._saveData=function(){Persistent.set("CurrentAccount",this._selectedAccountId),Persistent.set("CurrentSubpart",this._selectedSubpart)},window.AccountManager=a}();